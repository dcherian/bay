#+TITLE: Library of babel for bay of bengal stuff

* read sat data
#+NAME: read-mur
#+BEGIN_SRC ipython :session :results none
os.chdir('/home/deepak/bay/')
%matplotlib inline

if 'mur' in locals():
    mur.close()
    del mur

mur = xr.open_mfdataset('./datasets/mur/*.nc', autoclose=True)
mur.rename({'analysed_sst': 'sst'}, inplace=True)
# sst = mur.sst.chunk({'time':365})
#+END_SRC

#+NAME: read-cmc
#+BEGIN_SRC ipython :session :results none
os.chdir('/home/deepak/bay/')
%matplotlib inline

if 'mur' in locals():
    mur.close()
    del mur

cmc = xr.open_mfdataset('./datasets/cmc/*.nc', autoclose=True)
cmc.rename({'analysed_sst': 'sst'}, inplace=True)
sst = cmc['sst'].where(cmc.mask == 1).load()
sst.name = 'CMC SST'
#+END_SRC

* read PMEL files
#+NAME: read-rama-array
#+BEGIN_SRC ipython :session :results none
os.chdir('/home/deepak/bay/')
moorarr = importlib.reload(moorarr)

rama = moorarr.moorarr('RAMA',
                       'rama/data/t_xyzt_dy.cdf',
                       'rama/data/s_xyzt_dy.cdf',
                       'rama/data/cur_xyzt_dy.cdf')
#+END_SRC

* read tropflux
#+NAME: read-tropflux
#+BEGIN_SRC ipython :session :results none
import xarray as xr

swr = xr.open_mfdataset('../datasets/tropflux/swr*.nc', autoclose=True)
lwr = xr.open_mfdataset('../datasets/tropflux/lwr*.nc', autoclose=True)
tau = xr.open_mfdataset('../datasets/tropflux/tau_*.nc', autoclose=True)
taux = xr.open_mfdataset('../datasets/tropflux/tauy_*.nc', autoclose=True)
tauy = xr.open_mfdataset('../datasets/tropflux/taux_*.nc', autoclose=True)
net = xr.open_mfdataset('../datasets/tropflux/netflux_*.nc', autoclose=True)

tropflux = xr.merge([swr, lwr, tau , taux, tauy, net])
#+END_SRC

#+NAME: read-tropflux-lwr
#+BEGIN_SRC ipython :session :results none
#+END_SRC
* read χpod moorings
** RAMA
#+NAME: read-ra12
#+BEGIN_SRC ipython :session :results none
%matplotlib inline

import moor
import chipy
importlib.reload(moor)
importlib.reload(chipy)

import os
if 'rama' not in os.getcwd():
    os.chdir('/home/deepak/rama/scripts/')

ra12 = moor.moor(90, 12, 'RAMA 12N', '../RAMA13/')
ra12.AddChipod(526, 15, 'mm1', 'Turb.mat')
ra12.AddChipod(527, 30, 'mm1', 'Turb.mat')
ra12.AddChipod(810, 15, 'mm', 'Turb.mat', dir='../RAMA14/')
ra12.AddChipod(811, 30, 'mm1', 'Turb.mat', dir='../RAMA14/')
ra12.AddChipod(812, 45, 'mm2', 'Turb.mat', dir='../RAMA14/')
ra12.CombineTurb()
ra12.ReadMet('../data/met12n90e_10m.cdf', WindType='pmel')
# ra12.ReadMet('../data/jq0_12n90e_hr.mat', FluxType='merged')
ra12.ReadMet(FluxType='precip')
ra12.ReadTropflux('../tropflux/')
ra12.ReadVel('../data/cur12n90e_30m.cdf', FileType='pmel')
# ra12.ReadMet('../data/qnet12n90e_hr.cdf', FluxType='pmel')
ra12.ReadCTD('../RamaPrelimProcessed/RAMA13-corrected.mat', 'ramaprelim')
ra12.ReadCTD('../RamaPrelimProcessed/RAMA14-12N-corrected.mat', 'ramaprelim')

ra12.AddSeason([526, 527], 'NE', '2013-Dec-01', '2014-Feb-14')
ra12.AddSeason([526, 527], 'NE→SW', '2014-Feb-15', '2014-May-05')
ra12.AddSeason([526, 527], 'SW', '2014-May-06', '2014-Sep-24')
ra12.AddSeason([526, 527], 'SW→NE', '2014-Sep-25', '2014-Dec-12')

ra12.AddSpecialTimes([526, 527], 'FW1', '2014-Jan-15', '2014-Jan-19')
ra12.AddSpecialTimes([526, 527], 'Hudhud', '2014-Oct-08', '2014-Oct-11')

ra12.AddSeason([810, 811, 812], 'NE', '2014-Dec-12', '2015-Mar-01')
ra12.AddSeason([810, 811, 812], 'NE→SW', '2015-Mar-01', '2015-May-15')
ra12.AddSeason([810, 811, 812], 'SW', '2015-May-16', '2015-Oct-14')
ra12.AddSeason([810, 811, 812], 'SW→NE', '2015-Oct-15', '2015-Dec-01')

ra12.AddSpecialTimes([810, 811, 812], 'FW2', '2015-Apr-05', '2015-Apr-10')
ra12.AddSpecialTimes([810, 811, 812], 'FW3', '2015-Oct-28', '2015-Nov-05')
#+END_SRC

#+NAME: read-ra15
#+BEGIN_SRC ipython :session :results none
%matplotlib inline

import moor
import chipy
importlib.reload(moor)
importlib.reload(chipy)

import os
if 'rama' not in os.getcwd():
    os.chdir('/home/deepak/rama/scripts/')

ra15 = moor.moor(90, 15, 'RAMA 15N', '../RAMA14/')
ra15.AddChipod(813, 15, 'mm', 'Turb.mat')
ra15.AddChipod(814, 30, 'mm1', 'Turb.mat')
ra15.ReadMet('../data/met15n90e_10m.cdf', WindType='pmel')
ra15.ReadMet(WindType='sat')
ra15.ReadCTD('../RamaPrelimProcessed/RAMA14-15N.mat', 'ramaprelim')
ra15.ReadTropflux('../tropflux/')
ra15.ReadVel('../data/cur15n90e_30m.cdf', FileType='pmel')

ra15.AddSeason([813, 814], 'NE', '2014-Dec-01', '2015-Mar-01')
ra15.AddSeason([813, 814], 'NE→SW', '2015-Mar-01', '2015-May-15')
ra15.AddSeason([813, 814], 'SW', '2015-May-15', '2015-Oct-14')

ra15.AddSpecialTimes([813], 'FW4', '2015-Aug-12', '2015-Aug-20')
ra15.AddSpecialTimes([813, 814], 'Storm1', '2015-Jul-03', '2015-Jun-25')

#+END_SRC

#+NAME: read-ra12-2015
#+BEGIN_SRC ipython :session :results none
import chipy
import importlib
chipy = importlib.reload(chipy)

c810 = chipy.chipod('../RAMA14/data/', '810', best='mm', depth=15)
c811 = chipy.chipod('../RAMA14/data/', '811', best='mm1', depth=30)

c810.LoadT1T2()
#+END_SRC

#+NAME: read-527
#+BEGIN_SRC ipython :session :results none
import chipy
import importlib
chipy = importlib.reload(chipy)

c527 = chipy.chipod('../RAMA13/data/', '527', '2017-08-15.mat', best='mm', depth=15)
#+END_SRC

** EBOB
#+NAME: read-nrl1
#+BEGIN_SRC ipython :session :results none
%matplotlib inline
moor = importlib.reload(moor)
chipy = importlib.reload(chipy)

import os
if 'ebob' not in os.getcwd():
    os.chdir('/home/deepak/ebob/scripts/')

nrl1 = moor.moor(85.5, 5.5, 'NRL1', '../')
nrl1.AddChipod(500, depth=56, best='mm', fname='Turb.mat')
nrl1.AddChipod(501, depth=76, best='mm1', fname='Turb.mat')
nrl1.CombineTurb()
nrl1.ReadCTD('NRL1', FileType='ebob')
nrl1.ReadTropflux('../tropflux/')
#+END_SRC

#+NAME: read-nrl3
#+BEGIN_SRC ipython :session :results none
%matplotlib inline

import moor.moor as moor
import chipy.chipy as chipy
importlib.reload(moor)
importlib.reload(chipy)

import os
if 'ebob' not in os.getcwd():
    os.chdir('/home/deepak/ebob/scripts/')

nrl3 = moor.moor(85.5, 8, 'NRL3', '../')
nrl3.AddChipod(505, 28, 'mm', 'Turb.mat')
nrl3.ReadCTD('NRL3', FileType='ebob')
nrl3.ReadTropflux('../tropflux/')
#+END_SRC

#+NAME: read-nrl5
#+BEGIN_SRC ipython :session :results none
import moor.moor as moor
import chipy.chipy as chipy

importlib.reload(moor)
importlib.reload(chipy)

import os
if 'ebob' not in os.getcwd():
    os.chdir('/home/deepak/ebob/scripts/')

nrl5 = moor.moor(88.5, 8, 'NRL5', '../')
nrl5.AddChipod(518, depth=84, best='mm', fname='Turb.mat')
nrl5.AddChipod(519, depth=104, best='mm', fname='Turb.mat')
nrl5.ReadCTD('NRL5', FileType='ebob')
nrl5.ReadTropflux('../tropflux/')
#+END_SRC
